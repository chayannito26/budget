<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Budget Dashboard for tracking income, expenses, and budget allocations.">
    <meta name="keywords" content="budget, dashboard, income, expenses, finance">
    <meta name="author" content="Budget Tracker">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chayannito26.github.io/budget/dashboard.html">
    <meta property="og:title" content="Budget Dashboard">
    <meta property="og:description" content="Budget Dashboard for tracking income, expenses, and budget allocations.">
    <meta property="og:image" content="https://chayannito26.github.io/budget/dashboard-preview.png">
    <meta property="og:site_name" content="Budget Dashboard">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://chayannito26.github.io/budget/dashboard.html">
    <meta property="twitter:title" content="Budget Dashboard">
    <meta property="twitter:description" content="Budget Dashboard for tracking income, expenses, and budget allocations.">
    <meta property="twitter:image" content="https://chayannito26.github.io/budget/dashboard-preview.png">
    <title>Budget Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            margin-bottom: 1.5rem;
        }
        .progress {
            height: 25px;
            font-size: 0.8rem;
        }
        .progress-bar {
            font-weight: bold;
        }
        .table-responsive {
            margin-top: 2rem;
        }
        .card-title {
            font-weight: bold;
        }
        .summary-card .card-body {
            text-align: center;
        }
        .summary-card .display-4 {
            font-weight: bold;
        }
        .negative {
            color: #dc3545;
        }
        .positive {
            color: #198754;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .container { padding-top: 1rem; padding-bottom: 1rem; }
            h1 { font-size: 1.75rem; margin-bottom: 1.5rem; }
            .card { margin-bottom: 1rem; }
            .card-body { padding: 1rem; }
            .table-responsive { margin-top: 1rem; }
            .table th, .table td { padding: 0.5rem; font-size: 0.9rem; }
            .progress { height: 20px; font-size: 0.75rem; }
        }

        @media (max-width: 480px) {
            .container { padding-top: 0.5rem; padding-bottom: 0.5rem; }
            h1 { font-size: 1.5rem; margin-bottom: 1rem; }
            .card { margin-bottom: 0.75rem; }
            .card-body { padding: 0.75rem; }
            .card-title { font-size: 1.1rem; }
            .display-4 { font-size: 1.75rem; }
            .table th, .table td { padding: 0.4rem 0.3rem; font-size: 0.8rem; }
            .progress { height: 18px; font-size: 0.7rem; }
            .table-responsive { margin-top: 0.75rem; }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">Budget Dashboard</h1>

        <div class="row" id="summary-cards">
            <!-- Summary cards will be injected here -->
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Category</th>
                        <th>Budgeted</th>
                        <th>Spent</th>
                        <th>Remaining</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="budget-table-body">
                    <!-- Budget details will be injected here -->
                </tbody>
                <tfoot class="table-dark">
                    <tr id="table-footer">
                        <!-- Footer totals will be injected here -->
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const budgetUrl = 'https://raw.githubusercontent.com/chayannito26/budget/refs/heads/main/budget-data.json';
            const expensesUrl = 'https://raw.githubusercontent.com/chayannito26/expenses/refs/heads/main/expenses.json';
            const incomeUrl = 'https://raw.githubusercontent.com/chayannito26/income/refs/heads/main/revenues.json';

            Promise.all([
                fetch(budgetUrl).then(res => res.json()),
                fetch(expensesUrl).then(res => res.json()),
                fetch(incomeUrl).then(res => res.json())
            ]).then(([budgetData, expensesData, incomeData]) => {
                // Process data
                const totalIncome = incomeData.reduce((sum, item) => sum + item.amount, 0);
                const totalBudget = budgetData.reduce((sum, item) => sum + item.cost, 0);
                
                const expensesByCategory = expensesData.reduce((acc, expense) => {
                    acc[expense.type] = (acc[expense.type] || 0) + expense.amount;
                    return acc;
                }, {});

                const totalSpent = Object.values(expensesByCategory).reduce((sum, amount) => sum + amount, 0);

                // Render summary cards
                renderSummary(totalIncome, totalSpent, totalBudget);

                // Render budget table
                renderTable(budgetData, expensesByCategory);

            }).catch(error => {
                console.error('Error fetching budget data:', error);
                document.getElementById('budget-table-body').innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading data. Please try again later.</td></tr>';
            });

            function renderSummary(income, spent, budget) {
                const summaryContainer = document.getElementById('summary-cards');
                const balance = income - spent;
                const budgetRemaining = budget - spent;
                const toRaise = Math.max(0, budget - income);

                const cards = [
                    { title: 'Total Raised', value: income, isCurrency: true, color: 'positive' },
                    { title: 'Total Spent', value: spent, isCurrency: true, color: 'negative' },
                    { title: 'Fund Balance', value: balance, isCurrency: true, color: balance >= 0 ? 'positive' : 'negative' },
                    { title: 'Total Budget', value: budget, isCurrency: true, color: 'text-primary' },
                    { title: 'Budget Remaining', value: budgetRemaining, isCurrency: true, color: budgetRemaining >= 0 ? 'positive' : 'negative' },
                    { title: 'Funding Needed', value: toRaise, isCurrency: true, color: toRaise > 0 ? 'text-warning' : 'positive' }
                ];

                summaryContainer.innerHTML = cards.map(card => `
                    <div class="col-md">
                        <div class="card summary-card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-muted">${card.title}</h5>
                                <p class="display-6 ${card.color}">${card.isCurrency ? formatCurrency(card.value) : card.value}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function renderTable(budgetItems, expenses) {
                const tableBody = document.getElementById('budget-table-body');
                let tableContent = '';
                let totalBudgeted = 0;
                let totalSpent = 0;

                budgetItems.sort((a, b) => a.name_en.localeCompare(b.name_en)).forEach(item => {
                    const spent = expenses[item.name_en] || 0;
                    const remaining = item.cost - spent;
                    const percentage = item.cost > 0 ? (spent / item.cost) * 100 : 0;
                    const progressColor = getProgressBarColor(percentage);
                    
                    totalBudgeted += item.cost;
                    totalSpent += spent;

                    tableContent += `
                        <tr>
                            <td>${item.name_en}</td>
                            <td>${formatCurrency(item.cost)}</td>
                            <td>${formatCurrency(spent)}</td>
                            <td class="${remaining < 0 ? 'negative' : ''}">${formatCurrency(remaining)}</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar ${progressColor}" role="progressbar" style="width: ${percentage.toFixed(2)}%;" aria-valuenow="${percentage.toFixed(2)}" aria-valuemin="0" aria-valuemax="100">${percentage.toFixed(2)}%</div>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tableBody.innerHTML = tableContent;
                
                // Render footer
                const tableFooter = document.getElementById('table-footer');
                const totalRemaining = totalBudgeted - totalSpent;
                tableFooter.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td><strong>${formatCurrency(totalBudgeted)}</strong></td>
                    <td><strong>${formatCurrency(totalSpent)}</strong></td>
                    <td class="<strong>${totalRemaining < 0 ? 'negative' : ''}">${formatCurrency(totalRemaining)}</strong></td>
                    <td></td>
                `;
            }

            function getProgressBarColor(percentage) {
                if (percentage > 100) return 'bg-danger';
                if (percentage > 80) return 'bg-warning';
                if (percentage > 50) return 'bg-info';
                return 'bg-success';
            }

            function formatCurrency(amount) {
                return `৳${amount.toLocaleString('en-IN', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
            }
        });
    </script>
</body>
</html>
